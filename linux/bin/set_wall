#!/usr/bin/env bash

WALL_DIR="$HOME/Sync/wallpapers"

if [ -z "$1" ]; then
	wall=$(fd -t f . "$WALL_DIR" --exclude mobile --exclude pfp | shuf -n 1)
else
	wall="$1"
fi

if [ -z "$wall" ]; then
	echo "No wallpaper found." >&2
	exit 1
fi

cp -f "$wall" /var/tmp/wallpaper

if [[ $XDG_SESSION_TYPE == "x11" ]]; then
	feh --bg-fill "$wall"
else
	swww img "$wall" --transition-type=fade --transition-fps=144 --transition-duration=2
fi

wal -qetsni "$wall" &> /dev/null

cp -f "$HOME/.cache/wal/colors-cava.conf" "$HOME/.config/cava/config" && pkill -USR2 cava

if [[ $XDG_SESSION_TYPE == "x11" ]]; then
	betterlockscreen -u "$wall"
else
	~/.config/waybar/scripts/launch
fi
